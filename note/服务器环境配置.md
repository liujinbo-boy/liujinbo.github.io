### **添加部门人员账号并配置 Samba 映射**

#### 1. *添加系统用户（以添加用户* ljb为例）

\# 创建用户（-m自创建家目录，-s指定shell， -d指定家目录位置）

sudo useradd -m -s /bin/bash -d /media/bsj/HDD2/hw/ljb ljb

\# 设置密码

sudo passwd ljb

\# 按提示输入密码

#### **2. 安装并配置 Samba 服务**

##### **（1）安装 Samba**

\# Debian/Ubuntu

sudo apt install -y samba samba-common-bin

##### **（2）配置 Samba 共享目录**

编辑 Samba 配置文件：

sudo vim /etc/samba/smb.conf

在文件末尾添加以下配置（允许用户在windows访问 ）：

 

 

[ljb] #对应图中windows文件夹的ljb

```
  comment = Shared directory for department

  path = /media/bsj/HDD2/hw/ljb

  browseable = yes  # 允许浏览

  writable = yes   # 允许写入

  valid users = ljb

  create mask = 0755  # 新建文件权限

  directory mask = 0775  # 新建目录权限

  force user=ljb

  force group=ljb

  valid users=ljb
```

 

注意：写这个文件的时候最好删掉注释，否则容易出问题

 

![img](file:///C:\Users\Administrator\AppData\Local\Temp\ksohtml2912\wps1.jpg) 

##### **（3）添加 Samba 用户（需与系统用户同名）**

\# 将系统用户添加到Samba（密码可与系统密码不同）

sudo smbpasswd -a ljb

\# 按提示输入Samba访问密码

##### **（4）设置**共享目录权限

确保 Samba 用户对共享目录有访问权限：

这一步要重视，新手很容易出问题

##### **（5）重启 Samba 服务并验证**

\# Debian/Ubuntu

sudo systemctl restart smbd nmbd

sudo systemctl enable smbd nmbd # 开机自启

##### **（6）相关命令排查和验证Samba共享目录**

检查 Samba 服务状态（Linux 服务器端）

sudo systemctl status smbd nmbd

若状态为active (running)：服务正常；

 

验证xxx的 Samba 账户（Linux 服务器端）

sudo pdbedit -L -v | grep xxx

若输出包含xxx的信息，说明账户存在；若不存在，重新添加：

 

测试 Samba 账户认证：用smbclient模拟 Windows 访问，验证密码是否正确：

smbclient //localhost/xxx-U xxx

输入密码后若能成功进入共享，说明账户和密码正常。

 

### **搭建NFS文件系统环境**

配置 Linux 服务器的 NFS 服务，核心是安装 NFS 软件包、配置共享目录、启动服务并开放权限，以下是分步骤的详细操作指南。

友好提示：NFS有客户端和服务端，服务端是提供共享目录的，客户端是挂载共享目录的，

#### **1、服务器端配置（核心步骤）**

##### **（1）安装 NFS 服务软件包**

Ubuntu/Debian 系列：使用 apt 安装

sudo apt update && sudo apt install -y nfs-kernel-server

##### **（2）准备共享目录（/nfs） 友好提示：共享目录路径可以修改**

先确认目录是否存在，不存在则创建，并设置合适的权限（确保客户端能正常读写）。

\# 1. 创建目录（若已存在可跳过）

sudo mkdir -p /nfs

\# 2. 设置权限（示例：允许所有用户读写，可根据需求调整）

sudo chmod -R 755 /nfs

sudo chown -R nobody:nobody /nfs

##### **（3）配置 NFS 共享规则**

编辑 NFS 的核心配置文件/etc/exports，添加共享目录的规则

格式为：共享目录 客户端地址(权限参数)。

\# 用vim编辑配置文件

sudo vim /etc/exports

在文件末尾添加以下内容（根据实际需求修改客户端地址）：

\# 示例1：允许192.168.1.0/24网段的所有设备挂载，权限为读写

/nfs 192.168.1.0/24(rw,sync,no_root_squash,no_subtree_check)

\# 示例2：允许所有设备挂载

/nfs *(rw,sync,no_root_squash,no_subtree_check)

权限参数说明：

rw：允许客户端读写共享目录（ro为只读）。

sync：数据实时写入磁盘，保证数据一致性（推荐）。

no_root_squash：允许客户端以 root 身份操作目录（若不需要可改为root_squash）。

no_subtree_check：关闭子目录检查，提升 NFS 稳定性。

##### **（4）启动 NFS 服务并设置开机自启**

Ubuntu/Debian 系列：

\# 启动NFS服务（Ubuntu已集成rpcbind依赖）

sudo systemctl start nfs-kernel-server

\# 设置开机自启

sudo systemctl enable nfs-kernel-server

##### （5） **开放防火墙端口（关键！否则客户端无法连接）**

友好提示：操作防火墙容易出问题，可直接关掉防火墙

 

NFS 需要开放111（rpcbind）和2049（NFS 主端口），以及动态端口。

ufw 防火墙（Ubuntu 默认）：

\# 放行NFS服务

sudo ufw allow nfs

\# 重启防火墙

sudo ufw reload

 

##### （6） **验证与问题排查**

服务器端验证：查看 NFS 共享是否生效

\# 列出服务器已共享的目录

showmount -e localhost

\# 若输出包含"/nfs 192.168.1.0/24"，说明共享成功

 

如果NFS出现异常，重启一下NFS服务

sudo systemctl restart nfs-kernel-server

 

 

#### **2、客户端挂载配置（其他设备连接）**

在需要挂载 NFS 共享目录的设备上操作，以 Linux 客户端为例。

##### **（1）安装 NFS 客户端工具**

Ubuntu/Debian 系列：

sudo apt install -y nfs-common

##### **（2）创建本地挂载点（客户端存放共享文件的目录）**

\# 示例：在客户端创建/mnt/nfs_mount目录作为挂载点

sudo mkdir -p /mnt/nfs_mount

##### **（3）临时挂载 NFS 共享目录（重启后失效）**

\# 格式：sudo mount -t nfs 服务器IP:共享目录 客户端挂载点

sudo mount -t nfs -o nolock 192.168.100.4:/nfs  /mnt/nfs_mount

替换192.168.100.4为你的 NFS 服务器 IP，/nfs为服务器共享目录，/mnt/nfs_mount为客户端挂载点。

 

 

友好提示：linux内核6的版本不支持nfs -V2版本,如果服务端不支持NFS-V2,客户端仅支持NFS-V2,会导致挂载失败

查看NFS支持版本

cat /proc/fs/nfsd/versions

 

 

 

 

 

 

 

 

 

 

 

 

 

 